window.__require=function t(n,e,i){function s(c,a){if(!e[c]){if(!n[c]){var r=c.split("/");if(r=r[r.length-1],!n[r]){var h="function"==typeof __require&&__require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+c+"'")}}var l=e[c]={exports:{}};n[c][0].call(l.exports,function(t){return s(n[c][1][t]||t)},l,l.exports,t,n,e,i)}return e[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<i.length;c++)s(i[c]);return s}({Cell:[function(t,n,e){"use strict";cc._RF.push(n,"2d259xnIPhBHYOnPw5m7kZh","Cell");var i=t("Consts");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){this.blinkCounter=0},blink:function(t){var n=this,e=[];this.node.opacity=255;for(var s=2*i.CELL_BLINK_TIMES,o=function(t){e.push(cc.callFunc(function(){return n.node.opacity=t%2==0?0:255})),e.push(cc.delayTime(.3))},c=0;c<s;c++)o(c);e.push(cc.callFunc(function(){n.node.opacity=255,n.blinkFinish(t)})),this.node.runAction(cc.sequence(e))},blinkFinish:function(t){null!=t&&t()}}),cc._RF.pop()},{Consts:"Consts"}],CoinIcon:[function(t,n,e){"use strict";cc._RF.push(n,"54d65OeS2lPCJY8IcNgEOxq","CoinIcon"),cc.Class({extends:cc.Component,properties:{coinLabel:{default:null,type:cc.Label}},onLoad:function(){this.originPos=this.node.position},start:function(){},setCoinNum:function(t){this.coinLabel.string="+ "+t},flyToTarget:function(t,n){var e=this;this.node.active=!0,this.node.position=this.originPos;var i=[];i.push(cc.moveTo(2,t.position).easing(cc.easeCubicActionIn())),i.push(cc.callFunc(function(){e.node.active=!1,null!=n&&n()})),this.node.runAction(cc.sequence(i))}}),cc._RF.pop()},{}],CoinMan:[function(t,n,e){"use strict";cc._RF.push(n,"ea644Ts0ulD9biUydFkOX5O","CoinMan");var i=t("Game"),s=t("Consts");cc.Class({extends:cc.Component,properties:{},ctor:function(){this.bet=100},onLoad:function(){},start:function(){},costCoinAndAnim:function(t,n){var e=i.instance.userData,s=e.getCoin();if(e.costCoin(t)){var o=e.getCoin();return this.coinAnim(s,o,n),!0}return!1},addCoinAndAnim:function(t,n){var e=i.instance.userData,s=e.getCoin();if(e.addCoin(t)){var o=e.getCoin();return this.coinAnim(s,o,n),!0}return!1},coinAnim:function(t,n,e){var i={val:t};cc.tween(i).to(s.COIN_ANIM_TIME,{val:n},{progress:function(t,n,i,s){e.string=Math.floor(t+(n-t)*s)}}).call(function(){e.string=n}).start()},getWinCoinByWinId:function(t){var n=i.instance.resMan.tables.paytable[t].multi;return this.bet*n}}),cc._RF.pop()},{Consts:"Consts",Game:"Game"}],Consts:[function(t,n,e){"use strict";cc._RF.push(n,"a0a95gZS+1DjKj+/OWxeT/l","Consts");n.exports={REEL_NUM:3,CELL_BLINK_TIMES:3,COIN_ANIM_TIME:.5},cc._RF.pop()},{}],EventBus:[function(t,n,e){"use strict";cc._RF.push(n,"14f92xtEbJO0qkBjni80g42","EventBus");var i=cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.instance=this},start:function(){},send:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new cc.Event.EventCustom(n,!0);e&&i.setUserData(e),t.dispatchEvent(i)}});cc._RF.pop()},{}],EventNames:[function(t,n,e){"use strict";cc._RF.push(n,"05cbeekoMhG9peX2JYQH/C5","EventNames");n.exports={GAME_START:"game.start",GAME_REEL_FIN:"game.reel.fin"},cc._RF.pop()},{}],Game:[function(t,n,e){"use strict";cc._RF.push(n,"feb57RxHT9HPKj3RnTvRQr2","Game");var i=t("Reel"),s=t("EventNames"),o=t("on-off-button"),c=t("Prng"),a=t("Utils"),r=t("Consts"),h=t("CoinIcon"),l=cc.Class({extends:cc.Component,properties:{manNode:{default:null,type:cc.Node},reels:{default:[],type:[i]},spinButton:{default:null,type:o},autoSpinButton:{default:null,type:o},coinLabel:{default:null,type:cc.Label},coinIcon:{default:null,type:h}},onLoad:function(){var t=this;l.instance=this,this.userData=this.manNode.getComponent("UserData"),this.resMan=this.manNode.getComponent("ResMan"),this.coinMan=this.manNode.getComponent("CoinMan"),this.node.on(s.GAME_START,function(n){cc.log("game start!"),t.initGame()}),this.node.on(s.GAME_REEL_FIN,function(n){t._switchReelState(n.detail)}),this.spinButton.node.on("reel-spin",function(n){n.isOn||t.spin()}),this.autoSpinButton.node.on("reel-auto-spin",function(n){t.isAuto=!n.isOn}),this.initVals(),this.initUI()},initVals:function(){this.isAuto=!1,this.winIds=[],this.winCoin=0},initUI:function(){var t=this.userData.getCoin();this.coinLabel.string=t},initGame:function(){for(var t=0;t<r.REEL_NUM;++t)this.reels[t].init(this.resMan.tables["reel"+t],this)},start:function(){},simulateS2C:function(){var t=this;cc.log("Winner index is:"),this.resMan.playSound("reelRoll");for(var n=0;n<r.REEL_NUM;++n){var e=c.normalGen()%this.resMan.tables["reel"+n].length;this.winIds.push(this.resMan.getWinIdFromWinIdx(n,e)),cc.log(e),this.reels[n].setWinIdx(e),this.reels[n].spin()}var i=a.randomInt(2,3);this.scheduleOnce(function(){t._switchReelState("init")},i)},getWinId:function(){if(this.winIds.length!=r.REEL_NUM)return-1;for(var t=0;t<r.REEL_NUM-1;++t)if(this.winIds[t]!==this.winIds[t+1])return-1;return this.winIds[0]},spin:function(){this.coinMan.costCoinAndAnim(this.coinMan.bet,this.coinLabel)&&this.simulateS2C()},_switchReelState:function(t){switch(t){case"init":this.reels[0].toStop();break;case"reel1":this.reels[1].toStop();break;case"reel2":this.reels[2].toStop();break;case"reel3":this.toCompleteOneRd()}},toCompleteOneRd:function(){var t=this.getWinId();t>-1?(this.winCoin=this.coinMan.getWinCoinByWinId(t),this.toBlink()):this.onOneRdCompleted()},toBlink:function(){var t=this;this.resMan.playSound("lineWin");for(var n=0,e=0;e<this.reels.length;++e)this.reels[e].blink(function(){++n>=r.REEL_NUM&&t.onBlinkFinish()})},onBlinkFinish:function(){var t=this;this.resMan.playSound("coinsWin"),this.coinIcon.setCoinNum(this.winCoin),this.coinIcon.flyToTarget(this.coinLabel.node,function(){t.onOneRdCompleted()})},onOneRdCompleted:function(){this.winCoin>0&&this.coinMan.addCoinAndAnim(this.winCoin,this.coinLabel),this.restoreState(),this.spinButton.setOn(!0),this.isAuto&&this.spinButton.onTouch()},restoreState:function(){this.winIds=[],this.winCoin=0}});cc._RF.pop()},{CoinIcon:"CoinIcon",Consts:"Consts",EventNames:"EventNames",Prng:"Prng",Reel:"Reel",Utils:"Utils","on-off-button":"on-off-button"}],Prng:[function(t,n,e){"use strict";cc._RF.push(n,"7a78a0XXAlG+Lcoqx5r2zpd","Prng");var i={gen:function(t,n){return Math.floor(Math.random()*(n-t+1))+t},normalGen:function(){return i.gen(1,1e5)}};n.exports=i,cc._RF.pop()},{}],Reel:[function(t,n,e){"use strict";cc._RF.push(n,"5c1b0r+16RAfaPEAXN3jzj8","Reel");var i=t("EventNames"),s=t("EventBus");cc.Class({extends:cc.Component,properties:{reelTag:{default:"reel"},stopNodes:{default:[],visible:!1,type:[cc.Node]},tailNode:{default:null,visible:!1,type:cc.Node},visibleStops:{default:3,visible:!1,type:cc.Integer},padding:{default:0,visible:!1,type:cc.Integer},stopHeight:{default:0,visible:!1,type:cc.Integer},winnerIndex:{default:0,visible:!1,type:cc.Integer},winnerLineY:{default:0,visible:!1,type:cc.Integer},isRollingCompleted:{default:!1,visible:!1}},onLoad:function(){},init:function(t,n){this.cells=t,this.game=n;var e=this.game.resMan,i=t[0].cellId,s=e.tables.cells[i].res;this.winnerLineY=this.node.height/2;var o=cc.instantiate(e.cells[s]);this.stopHeight=o.height,this.stopWidth=o.width,this.padding=(this.node.height-this.visibleStops*this.stopHeight)/(this.visibleStops+1),this.resetAllNodes(),this.isRollingCompleted=!0,this.isPrepareCompleted=!1,this.reelMidHeightForCell=this.node.height/2-this.stopHeight/2,this.bourceGap=160,this.finAnimDelay=1,this.btmLmt=-2*(this.stopHeight+this.padding),this.speed=2e3},resetAllNodes:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.padding,e=this.node.width/2-this.stopWidth/2,i=this.cells,s=this.game.resMan;t&&(this.stopNodes=[]);for(var o=0;o<i.length;o++){var c=null;if(t){var a=i[o].cellId,r=s.tables.cells[a].res;c=cc.instantiate(s.cells[r]),this.node.addChild(c),this.stopNodes.push(c)}else c=this.stopNodes[o];c.setPosition(cc.v2(e,n)),n+=this.padding+this.stopHeight}this.tailNode=this.stopNodes[this.stopNodes.length-1]},update:function(t){if(!this.isRollingCompleted){var n=this.stopNodes[this.winnerIndex];if(this.isPrepareCompleted&&n.y<this.reelMidHeightForCell){this.isRollingCompleted=!0;var e=this.reelMidHeightForCell-n.y;this.animAndToNext(e)}else for(var i=this.speed*t,s=0;s<this.stopNodes.length;s++){var o=this.stopNodes[s];if(o.y-=i,o.y<this.btmLmt){var c=this.tailNode.y+this.tailNode.height+this.padding;o.y=c,0===s&&(o.y=c-i),this.tailNode=o}}}},animAndToNext:function(t){var n=this;this.game.resMan.playSound("reelStop"),this.resetY();var e;e=this.bourceGap-t,t=this.bourceGap;for(var i=0;i<this.stopNodes.length;i++){var s=this.stopNodes[i];s.y-=e,s.runAction(cc.moveBy(this.finAnimDelay,cc.v2(0,t)).easing(cc.easeBackOut()))}var o=cc.sequence(cc.delayTime(this.finAnimDelay),cc.callFunc(function(){n.notifyFinish()}));this.node.runAction(o)},blink:function(t){this.stopNodes[this.winnerIndex].getComponent("Cell").blink(t)},resetY:function(t){var n,e,i=this.winnerIndex,s=this.padding+this.stopHeight,o=this.stopNodes.length;n=t?this.reelMidHeightForCell:this.stopNodes[i].y;for(var c=i;c<this.stopNodes.length;c++){this.stopNodes[c].y=n,n+=s}for(var a=0;a<i-1;a++){this.stopNodes[a].y=n,n+=s}e=0===i?this.stopNodes.length-1:i-1,this.stopNodes[e].y=this.stopNodes[i].y-s;for(var r=0,h=0;h<o;h++){var l=this.stopNodes[h];l.y>r&&(this.tailNode=l,r=l.y)}},notifyFinish:function(){s.instance.send(this.node,i.GAME_REEL_FIN,this.reelTag)},setWinIdx:function(t){this.winnerIndex=t},spin:function(){this.initReelState()},initReelState:function(){this.isPrepareCompleted=!1,this.isRollingCompleted=!1},toStop:function(){this.isPrepareCompleted=!0},getWinnerStop:function(){return this.stopNodes[this.winnerIndex]},dump:function(){cc.log("dump A: %s, %d, %d, %d",this.reelTag,this.padding,this.stopHeight,this.node.height);for(var t=0;t<this.stopNodes.length;t++){var n=this.stopNodes[t].getPosition();cc.log("dump B: %d(%d), %f, %f",t,this.winnerIndex,n.x,n.y)}}}),cc._RF.pop()},{EventBus:"EventBus",EventNames:"EventNames"}],ResMan:[function(t,n,e){"use strict";cc._RF.push(n,"1dbad8oiOBO6blnwuAoIMDu","ResMan");var i=t("EventNames"),s=t("EventBus");cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.log("[LOAD] ResMan"),this.needResCount=3,this.resCount=0,this.tables={},this.cells={},this.sounds={}},start:function(){this.loadTables(),this.loadCells(),this.loadSounds()},check:function(){this.resCount++,this.resCount>=this.needResCount&&this.nofityFinish()},loadTables:function(){var t=this;cc.loader.loadResDir("tables",function(n,e){if(n);else{for(var i=0;i<e.length;++i){var s=e[i];s instanceof cc.JsonAsset&&(t.tables[s.name]=s.json)}t.check()}})},loadCells:function(){var t=this;cc.loader.loadResDir("cells",function(n,e){if(n);else{for(var i=0;i<e.length;++i){var s=e[i];s instanceof cc.Prefab&&(t.cells[s.name]=s)}t.check()}})},loadSounds:function(){var t=this;cc.loader.loadResDir("sounds",function(n,e){if(n)cc.error(n);else{for(var i=0;i<e.length;++i){var s=e[i];cc.log(s),s instanceof cc.AudioClip&&(t.sounds[s.name]=s)}t.check()}})},getWinIdFromWinIdx:function(t,n){return this.tables["reel"+t][n].cellId},playSound:function(t){var n=this.sounds[t];n&&cc.audioEngine.playEffect(n,!1)},nofityFinish:function(){s.instance.send(this.node,i.GAME_START)}}),cc._RF.pop()},{EventBus:"EventBus",EventNames:"EventNames"}],UserData:[function(t,n,e){"use strict";cc._RF.push(n,"73831qc6UxEjo9+ccLc33mL","UserData"),cc.Class({extends:cc.Component,properties:{},ctor:function(){this.coin=5e3},getCoin:function(){return this.coin},onLoad:function(){},start:function(){},costCoin:function(t){return!!(t>0&&this.isCoinEnough(t))&&(this.coin-=t,!0)},addCoin:function(t){return t>0&&(this.coin+=t,!0)},isCoinEnough:function(t){return this.coin>=t}}),cc._RF.pop()},{}],Utils:[function(t,n,e){"use strict";cc._RF.push(n,"22bf1Kj1whKCZyAEFX+olpr","Utils");var i={randomInt:function(t,n){return Math.floor(Math.random()*(n-t+1))+t}};n.exports=i,cc._RF.pop()},{}],"on-off-button":[function(t,n,e){"use strict";cc._RF.push(n,"e88efl+1XFCULfozm0f16Lj","on-off-button"),cc.Class({extends:cc.Component,properties:{mouseDownName:{default:"on-off-mousedown"},sprite:{default:null,type:cc.Sprite},spriteTextureUp:{default:null,type:cc.SpriteFrame},spriteTextureDown:{default:null,type:cc.SpriteFrame},isOn:{default:!1},isSelfControl:{default:!1}},onLoad:function(){var t=this;this.setOn(!0);var n=function(t){};this.node.on("touchstart",function(n){t.onTouch()},this.node),this.node.on("touchend",n,this.node),this.node.on("touchcancel",n,this.node)},start:function(){this.setOn(this.isOn)},onTouch:function(){(this.isSelfControl||this.isOn)&&(this.setOn(!this.isOn),this.node.emit(this.mouseDownName,{isOn:this.isOn}))},setOn:function(t){this.isOn=t,t?this.updateSpriteFrame(this.sprite,this.spriteTextureUp):this.updateSpriteFrame(this.sprite,this.spriteTextureDown)},updateSpriteFrame:function(t,n){t&&n&&(t.spriteFrame=n)}}),cc._RF.pop()},{}]},{},["Consts","Cell","Game","Reel","EventBus","EventNames","CoinMan","ResMan","UserData","Prng","Utils","CoinIcon","on-off-button"]);